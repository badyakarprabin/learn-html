<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        canvas {
            border: 1px solid black;
        }

        body {
            margin: 0;

        }
    </style>
</head>

<body>
    <canvas></canvas>
    <script>    
        var canvas = document.querySelector('canvas');
        canvas.width = 400 || window.innerWidth;
        canvas.height = 400 || window.innerHeight;
        let ts = 80;
        let gs = 5;
        var c = canvas.getContext('2d');
        var snake;
        var food;

        function init() {
            snake = new Snake();
            food = new Food();
        }

        addEventListener('keydown', (e) => {
            if (e.keyCode === 38) {
                snake.direction(0, -1)
            }
            else if (e.keyCode === 40) {
                snake.direction(0, 1);
            }
            else if (e.keyCode === 37) {
                snake.direction(-1, 0);
            }
            else if (e.keyCode === 39) {
                snake.direction(1, 0);
            }
        })

        function Food() {
            this.x = Math.floor(Math.random() * ts);
            this.y = Math.floor(Math.random() * ts);

            this.draw = () => {
                c.fillStyle = "green";
                c.fillRect(this.x * gs, this.y * gs, 20, 20)
            }
        }

        function Snake() {
            this.x = 0;
            this.y = 0;
            this.xspeed = 0;
            this.yspeed = 0;
            this.trail = [];
            this.tail = 5;
            this.score = 0;

            this.direction = function (x, y) {
                this.xspeed = x;
                this.yspeed = y
            }

            this.update = function () {
                this.x = this.x + this.xspeed;
                this.y = this.y + this.yspeed;
                if (this.x < 0) {
                    this.x = ts
                }
                else if (this.x > ts - 1) {
                    this.x = 0 - 1
                }
                else if (this.y < 0) {
                    this.y = ts - 1
                }
                else if (this.y > ts - 1) {
                    this.y = 0
                }

                if (Math.floor(food.x) === this.x && Math.floor(food.y) === this.y) {
                    console.log('you scored')
                    this.tail++;
                    this.score++;
                    food.x = Math.floor(Math.random() * 20);
                    food.y = Math.floor(Math.random() * 20);
                }

                console.log(getDistance())
                this.trail.push({ x: this.x, y: this.y });
                console.log('last', this.trail, this.tail)

            }

            this.draw = function () {
                // c.beginPath();
                for (var i = 0; i < this.trail.length; i++) {
                    c.fillStyle = "red";
                    c.fillRect(this.x * gs, this.y * gs, 20, 20);
                    if (this.trail[i].x == this.x && this.trail[i].y == this.y) {
                        this.tail = 5;
                    }
                }
                this.trail.push({ x: this.x + this.xspeed, y: this.y + this.yspeed });

                while (this.trail.length > this.tail) {
                    this.trail.shift();
                }
                c.font = "30px bold"
                c.fillText(this.score, 50, 50)
                // c.fillRect(this.x, this.y, 10, 10)
                // c.fill();
                // c.closePath()
            }
        }

        function getDistance() {
            let xDistance = food.x - snake.x;
            let yDistance = food.y - snake.y;
            return Math.sqrt(Math.pow(xDistance) + Math.pow(yDistance))
        }

        setInterval(animate, 1000 / 15)
        function animate() {
            c.clearRect(0, 0, canvas.width, canvas.height);
            snake.draw();
            food.draw();
            snake.update();
            // requestAnimationFrame(animate);
            // if (snake.x < -1) {
            //     alert('game over');
            //     return false;
            // }
        }

        init();
        animate();

    </script>
</body>

</html>